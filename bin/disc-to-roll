#!/usr/bin/env python

import logging
import os
import argparse
import cv2
from hmsm import utils, cardboard_discs

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("input", help = "Input image file")
    parser.add_argument("output", help = "Filename to write output image to")
    parser.add_argument("-t", "--threshold", dest = "threshold", default = None, const = None, nargs= "?", help = "Threshold value to use for binarization, must be in range [0,255] if provided")
    parser.add_argument("-o", "--offset", dest = "offset", default = 0, const = 0, nargs= "?", help = "Offset of the disc starting position, in degrees. Must be in range [0,360] if provided")
    parser.add_argument("-d", "--debug", action = "store_true", help = "Enable debug output. Note that this will also output various messages from other used python packages.")
    parser.set_defaults(debug = True, offset = 0, threshold = None)                                                   
    args = parser.parse_args("5070081_22.JPG disc_roll.jpg".split())

    logging.basicConfig(
        level = logging.DEBUG if args.debug else logging.INFO,
        format = "%(asctime)s [%(levelname)s]: %(message)s"
    )

    image = utils.read_as_binary_image(args.input)
    output = cardboard_discs.transform_to_rectangle(image, args.offset)
    cv2.imwrite(args.output, output)

if __name__ == "__main__":
    main()